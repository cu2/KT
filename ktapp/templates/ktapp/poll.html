{% extends "ktapp/layout.html" %}
{% load kt_extras %}

{% block title %}{{ poll.title }} - Közkérdés - Kritikus Tömeg{% endblock %}

{% block header %}
    <h1>{{ poll.title }}</h1>
    {% if poll.state == 'O' %}
        <p>{% if poll.created_by %}<a href="{% url 'user_profile' poll.created_by.id poll.created_by.slug_cache %}">{{ poll.created_by.username }}</a> kérdése, {% endif %}{{ poll.open_from|date:"Y. F j." }}</p>
    {% else %}
        <p>{% if poll.created_by %}<a href="{% url 'user_profile' poll.created_by.id poll.created_by.slug_cache %}">{{ poll.created_by.username }}</a> kérdése, {% endif %}{{ poll.open_from|date:"Y. F j." }}-{{ poll.open_until|date:"Y. F j." }}</p>
    {% endif %}
{% endblock %}

{% block main %}
    <div class="centered_content">

        <ul class="poll">
            {% for pollchoice, pollchoice_percent, pollchoice_px, your_vote in pollchoices %}
                {% if poll.state == 'O' %}
                    <li>
                        {% if user.is_authenticated and your_vote %}<b>{% endif %}
                        [{{ pollchoice.number_of_votes }}] {{ pollchoice.choice }}
                        {% if user.is_authenticated and your_vote %}</b>{% endif %}
                        {% if user.is_authenticated %}
                            {% if your_vote %}
                                <form action="{% url 'poll_vote' %}" method="post" class="inline" style="vertical-align: 1px">
                                    {% csrf_token %}
                                    <input type="hidden" name="poll" value="{{ poll.id }}" />
                                    <input type="hidden" name="pollchoice" value="{{ pollchoice.id }}" />
                                    <input type="hidden" name="vote" value="0" />
                                    <input type="submit" value="-" class="small_button" />
                                </form>
                            {% else %}
                                <form action="{% url 'poll_vote' %}" method="post" class="inline" style="vertical-align: 1px">
                                    {% csrf_token %}
                                    <input type="hidden" name="poll" value="{{ poll.id }}" />
                                    <input type="hidden" name="pollchoice" value="{{ pollchoice.id }}" />
                                    <input type="hidden" name="vote" value="1" />
                                    <input type="submit" value="+" class="small_button" />
                                </form>
                            {% endif %}
                        {% endif %}
                    </li>
                {% else %}
                    <li><span style="display: inline-block; width: {{ pollchoice_px }}px; background: rgb(0,0,0)">&nbsp;</span> {% if pollchoice.number_of_votes %}<span class="pollstat">{{ pollchoice_percent|floatformat:"0" }}% ({{ pollchoice.number_of_votes }})</span>{% endif %} {{ pollchoice.choice }}</li>
                {% endif %}
            {% endfor %}
        </ul>

        {% for c in comments %}
            {% include 'ktapp/blocks/comment_block.html' with comment=c %}
        {% endfor %}

    </div>
{% endblock %}
