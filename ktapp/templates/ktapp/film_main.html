{% extends "ktapp/layout.html" %}

{% block title %}{{ film.orig_title }} [{{ film.year }}] - Kritikus Tömeg{% endblock %}

{% block header %}
    <h1>{{ film.orig_title }} [{{ film.year }}]</h1>
    {% if film.other_titles %}
        <h2>{{ film.other_titles|linebreaksbr }}</h2>
    {% endif %}
    {% if directors %}
        <h3>({% for director in directors %}<a href="{% url 'artist' director.id director.name|slugify %}">{{ director.name }}</a>{% if not forloop.last %} - {% endif %}{% endfor %})</h3>
    {% endif %}
{% endblock %}

{% block main %}

    {% if film.plot_summary %}
        <p>{{ film.plot_summary|linebreaksbr }}</p>
    {% endif %}

    {% if roles %}
        <h2>Szereplők</h2>
        <table>
        {% for role in roles %}
            <tr>
                <td><a href="{% url 'role' role.id role.role_name|slugify %}">{{ role.role_name }}</a>{% if role.actor_subtype == "V" %} (hangja){% endif %}{% if role.actor_subtype == "D" %} (magyar hangja){% endif %}</td>
                <td><a href="{% url 'artist' role.artist.id role.artist.name|slugify %}">{{ role.artist.name }}</a></td>
            </tr>
        {% endfor %}
        </table>
    {% endif %}

    <h2>Szerinted</h2>
    {% if user.is_authenticated %}
        <div>
        {% for r in ratings %}
            {% if r == rating %}
                <b>{{ r }}</b>
            {% else %}
                <form action="{% url 'vote' %}" method="post" class="inline">
                    {% csrf_token %}
                    <input type="hidden" name="film_id" value="{{ film.pk }}" />
                    <input type="hidden" name="rating" value="{{ r }}" />
                    <input type="submit" value="{{r}}" />
                </form>
            {% endif %}
        {% endfor %}
        </div>
        <div>
        {% if rating == 0 %}
            <b>Nem tudom.</b>
        {% else %}
            <form action="{% url 'vote' %}" method="post" class="inline">
                {% csrf_token %}
                <input type="hidden" name="film_id" value="{{ film.pk }}" />
                <input type="hidden" name="rating" value="0" />
                <input type="submit" value="Nem tudom." />
            </form>
        {% endif %}
        </div>
    {% else %}
        <p>Ahhoz, hogy szavazhass, be kell <a href="{% url 'login' %}">jelentkezned</a>.</p>
    {% endif %}

    <h2>Kommentek{% if comments %} ({{ comments.count }}){% endif %}</h2>
    {% include 'ktapp/new_comment_block.html' %}
    {% for c in comments %}
        {% include 'ktapp/comment_block.html' with comment=c %}
    {% empty %}
        <p>Nincsenek.</p>
    {% endfor %}

    <h2>Idézetek{% if quotes %} ({{ quotes.count }}){% endif %}</h2>
    {% include 'ktapp/new_quote_block.html' %}
    {% for q in quotes %}
        <h3>{{ q.created_at }} {{ q.created_by }}</h3>
        <p>{{ q.content }}</p>
    {% empty %}
        <p>Nincsenek.</p>
    {% endfor %}

{% endblock %}
